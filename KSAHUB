-- Stable Speed Bypass with Key KSA
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

local correctKey = "KSA"
local enabled = false
local boostedSpeed = 32
local scriptActivated = false

-- Key Input GUI
local keyFrame = Instance.new("Frame")
keyFrame.Size = UDim2.new(0,250,0,60)
keyFrame.Position = UDim2.new(0.5,-125,0.5,-30)
keyFrame.BackgroundColor3 = Color3.fromRGB(50,50,50)
keyFrame.Parent = playerGui

local keyInput = Instance.new("TextBox")
keyInput.Size = UDim2.new(0.7,0,1,0)
keyInput.Position = UDim2.new(0,0,0,0)
keyInput.PlaceholderText = "Enter Key"
keyInput.TextScaled = true
keyInput.Font = Enum.Font.GothamBold
keyInput.TextColor3 = Color3.fromRGB(255,255,255)
keyInput.BackgroundColor3 = Color3.fromRGB(70,70,70)
keyInput.Name = "KSA_Input" -- ما فيش TextBox اسمه TextBox
keyInput.Parent = keyFrame

local submitButton = Instance.new("TextButton")
submitButton.Size = UDim2.new(0.3,0,1,0)
submitButton.Position = UDim2.new(0.7,0,0,0)
submitButton.Text = "Submit"
submitButton.TextScaled = true
submitButton.Font = Enum.Font.GothamBold
submitButton.TextColor3 = Color3.fromRGB(255,255,255)
submitButton.BackgroundColor3 = Color3.fromRGB(0,150,0)
submitButton.Parent = keyFrame

-- Main GUI (KSAHUB SPEED)
local screenGui = Instance.new("ScreenGui")
screenGui.Parent = playerGui
screenGui.ResetOnSpawn = false
screenGui.Enabled = false -- مخفي في البداية

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0,180,0,100)
frame.Position = UDim2.new(1,-190,0,20)
frame.BackgroundColor3 = Color3.fromRGB(40,40,40)
frame.Active = true
frame.Parent = screenGui

local title = Instance.new("TextLabel", frame)
title.Size = UDim2.new(1,0,0,25)
title.Text = "KSAHUB SPEED"
title.BackgroundTransparency = 1
title.Font = Enum.Font.GothamBold
title.TextColor3 = Color3.fromRGB(255,255,255)
title.TextScaled = true

-- Speed Button
local speedButton = Instance.new("TextButton")
speedButton.Size = UDim2.new(0.45,0,0,30)
speedButton.Position = UDim2.new(0.05,0,0,30)
speedButton.Text = "OFF"
speedButton.TextScaled = true
speedButton.Font = Enum.Font.GothamBold
speedButton.TextColor3 = Color3.fromRGB(255,255,255)
speedButton.BackgroundColor3 = Color3.fromRGB(200,0,0)
speedButton.Parent = frame

-- Slider (TextBox + Label)
local sliderBox = Instance.new("TextBox")
sliderBox.Size = UDim2.new(0.45,0,0,30)
sliderBox.Position = UDim2.new(0.5,0,0,30)
sliderBox.Text = tostring(boostedSpeed)
sliderBox.TextScaled = true
sliderBox.Font = Enum.Font.GothamBold
sliderBox.TextColor3 = Color3.fromRGB(255,255,255)
sliderBox.BackgroundColor3 = Color3.fromRGB(60,60,60)
sliderBox.Parent = frame

local sliderLabel = Instance.new("TextLabel")
sliderLabel.Size = UDim2.new(1,0,0,25)
sliderLabel.Position = UDim2.new(0,0,0,70)
sliderLabel.Text = "Speed: "..boostedSpeed
sliderLabel.BackgroundTransparency = 1
sliderLabel.Font = Enum.Font.GothamBold
sliderLabel.TextColor3 = Color3.fromRGB(255,255,255)
sliderLabel.TextScaled = true
sliderLabel.Parent = frame

-- Toggle Speed
speedButton.MouseButton1Click:Connect(function()
    enabled = not enabled
    if enabled then
        speedButton.Text = "ON"
        speedButton.BackgroundColor3 = Color3.fromRGB(0,200,0)
    else
        speedButton.Text = "OFF"
        speedButton.BackgroundColor3 = Color3.fromRGB(200,0,0)
    end
end)

-- Update speed from slider
sliderBox.FocusLost:Connect(function()
    local val = tonumber(sliderBox.Text)
    if val and val >= 16 and val <= 120 then
        boostedSpeed = val
        sliderLabel.Text = "Speed: "..boostedSpeed
    else
        sliderBox.Text = tostring(boostedSpeed)
    end
end)

-- Draggable system
local dragging, dragInput, dragStart, startPos
frame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = frame.Position
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then dragging = false end
        end)
    end
end)
frame.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)
UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        local delta = input.Position - dragStart
        frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X,
            startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end)

-- Stable Speed system
RunService.RenderStepped:Connect(function()
    if scriptActivated and enabled then
        local char = player.Character
        if char and char:FindFirstChild("Humanoid") and char:FindFirstChild("HumanoidRootPart") then
            local hum = char:FindFirstChild("Humanoid")
            local hrp = char:FindFirstChild("HumanoidRootPart")

            hum.WalkSpeed = 16
            if hum.MoveDirection.Magnitude > 0 then
                hrp.Velocity = hum.MoveDirection * boostedSpeed + Vector3.new(0, hrp.Velocity.Y, 0)
            end
        end
    end
end)

-- Key submission
local function activateScript()
    scriptActivated = true
    keyFrame:Destroy()
    screenGui.Enabled = true
end

submitButton.MouseButton1Click:Connect(function()
    if keyInput.Text == correctKey then
        activateScript()
    else
        keyInput.Text = ""
        keyInput.PlaceholderText = "Wrong Key!"
    end
end)
